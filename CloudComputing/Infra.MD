# IT 인프라
- https://futurecreator.github.io/2018/11/09/it-infrastructure-basics/
- https://ithub.tistory.com/249
---
## Chapter
1. IT Infrastructure란
2. 개발자가 인프라를 알아야 하는 이유
3. 인프라 구성요소
4. On-premises & Cloud
    - On-premises
    - Public Cloud
    - Private Cloud
    - Hybrid Cloud
    - 클라우드가 유리한 경우
    - 온프레미스가 유리한 경우
5. 하드웨어
    - CPU
    - 메모리
    - 데이터 스토리지
    - 기타 하드웨어
    - 방화벽
6. 네트워크
    - 네트워크 주소
    - MAC 
    - IP
    - OSI
        1. 물리 계층
        2. 데이터 링크 계층
        3. 네트워크 계층
        4. 전송 계층
        5. 세션 계층
        6. 프레젠테이션 계층
        7. 응용 계층
    - TCP/IP
7. 리눅스
    - 리눅스 커널
        - 디바이스 관리
        - 프로세스 관리
        - 메모리 관리
        - 쉘
        - 파일 시스템
    - 디렉토리 구성
    - 보안 기능
        - 계정에 대한 권한 설정
        - 네트워크 필터링
        - SELinux
    - 리눅스 배포판
8. 미들웨어
    - 웹 서버
    - DBMS
    - 시스템 모니터링
9. 인프라 구성 관리
    - Immutable Infrastructure
    - Infrastructure as Code
    - 인프라 구성 관리 툴
    - Continuous Integration 와 인프라
    - Continuous Delivery 와 인프라
10. 가상화(Continuous Delivery 와 인프라)
    - 호스트형 서버 가상화
    - 하이퍼바이저형 가상화
11. 컨테이너
    - 도커
    - 쿠버네티스
---
### 1. IT Infrastructure란
IT 인프라 : 애플리케이션을 동작시키기 위해 필요한 하드웨어, 네트워크, OS, 미들웨어 등 시스템 기반을 뜻함.
- 시스템 요구 사항
    기능적인 요구 사항 : 시스템 기능, 시스템이 무엇을 할 수 있는 것  
    비기능적인 요구사항 : 시스템의 성능, 안정성, 확장성, 보안 등. 인프라와 관련됨 
### 2. 개발자가 인프라를 알아야 하는 이유
데이터센터, 서버실에 서버를 두고 직접 관리하던 온프레미스 방식에서 가상의 서버를 여러 대 띄우는 클라우드 방식으로 바뀌게 됨.
이러한 분산 환경에서 인프라 엔지니어는 자동 관리를 위한 오케스트레이셔을 위해 코드 작성 능력이 필요하게 되고 애플리케이션 엔지니어도 인프라 엔지니어 업무를 직접 할 수 있게 되면서 인프라 관련 지식이 필요하게 됨.
### 3. 인프라 구성요소
1. Hardware 
    서버 장비 본체, 스토리지, 전원장치 등
    넓은 의미에서는 하드웨어를 설치하는 데이터 센터의 설비(건물, 공조, 보안 설비, 소화 설비 등)도 포함됨.
2. Network
    사용자가 원격으로 접근할 수 있도록 서버를 연결하는 도구.
    라우터, 스위치, 방화벽 등 네트워크 장비와 이를 연결하는 케이블 배선 등이 있음.
    사용자가 단말에서 무선으로 연결할 때 필요한 액세스 포인트(Access Point, AP)도 있음
3. Operating System
    하드웨어, 네트워크 장비를 제어하기 위한 기본적인 소프트웨어로 리소스, 프로세스를 관리함.
    - 클라이언트 OS : Windows, macOS 등
    - 서버 OS : Linux, Unix, Windows Server
4. Middleware
    서버 상에서 서버가 특정 역할을 하도록 기능을 제공하는 소프트웨어
### 4. On-premises & Cloud
1. On-premises
    데이터 센터, 서버실에 서버를 두고 직접 관리하는 방식. 직접 서버, 네트워크 장비, OS, 스토리지, 각종 솔루션 등을 직접 사서 설치하고 관리해야 함.
    온프레미스는 초기 투자 비용이 크고 사용 예측량을 가늠하기 힘들어서 사용량이 적어도 유지비용은 그대로 나가는 단점이 있음.
2. Public Cloud
    인터넷을 불특정 다수에게 서비스 형태로 제공되는 시스템으로 AWS,GCP,Azure 등 클라우드 프로바이더가 데이터 센터와 인프라를 보유하고 있음.
    제공하는 서비스에 따라 IaaS, PaaS, SaaS 등
3. Private Cloud
    퍼블릭 클라우드에서 이용자를 한정한 형태. 기업 내 서비스와 같은 것으로 보안이 좋고 독자적인 기능이나 서비스를 추가하기 쉬움.
4. 클라우드가 유리한 경우
    트래픽의 변동이 많은 시스템. 클라우드 시스템에서는 트래픽에 따라 자동으로 증설해주는 오토스케일링(Auto Scaling)이 있어 유리함.
    클라우드 데이터센터는 전 세계에 퍼져 있어서 자연재해로 데이터 시스템이 다운되더라도 다른 곳에서 시스템을 계속 운영할 수 있음.
    빨리 서비스를 제공해야 하는 시스템, PoC, 초기 투자금이 적은 스타트업, 개인 개발자들이 클라우드가 유리함.
5. 온프레미스가 유리한 경우
    온프레미스와 클라우드 모두 가용성을 보장함. 온프레미스는 서버가 죽지 않는 것을 목표로 하고 클라우드는 많은 인스턴스로 이루어진 분산환경에서 인스턴스가 죽으면 다른 인스턴스가 빠르게 대체하는 것을 의미함. 클라우드를 사용할 때 가용성을 보장하기 위해서 직접 설계해야 함.
    기밀성이 높은 데이터의 경우에도 온프레미스가 유리함. 자사 보안보다 클라우드 프로바이더 보안이 더 좋을 수 있으나 물리적인 저장소를 명확히 알 필요가 있을때 온프레미스가 유리함. 또한 멀티 클라우드를 사용하면 각 클라우드 프로바이더마다 보안 정책이 달라서 보안 표준을 구축하기 어려움.
    이 외에 특정 유료 솔루션을 사용하는 경우나 클라우드가 지원하지 않는 특수한 플랫폼을 사용하는 경우에는 클라우드를 이용할 수 없음.
6. Hybrid Cloud
    각 시스템 특성에 맞게 온프레미스와 클라우드를 함께 사용하는 것으로 클라우드 프로바이더들도 각자의 장점이 달라서 여러 클라우드를 함께 사용하기도 함.
### 5. 하드웨어
1. CPU
    CPU성능은 코어, 캐시에 영향을 받음. 코어가 많을수록 동시에 처리하는 연산이 늘어나고 메모리와의 처리 속도를 완화하기 위한 캐시는 크기가 클수록 성능이 좋음. 
    GPU는 그래픽을 처리하는 특화된 프로세서인데 CPU가 직렬 처리에 최적화된 몇개의 코어로 구성된 반면, GPU는 병렬 처리에 최적화된 작고 많은 코어로 이루어져 있음.
2. 메모리
    주기억장치인 메모리는 데이터 용량이 크거나 전송 속도가 고속일수록 고성능임. 서버용으로는 전력 소모가 적고 오류처리가 탑재되어 있는 것을 주로 선정함.
3. 데이터 스토리지
    하드디스크, SSD 등으로 데이터를 저장하는 디바이스. 보통 스토리지 속도가 제일 느리기 때문에 스토리지 용량이나 읽기, 쓰기 속도가 시스템 전체의 속도에 영향을 주는 경우가 많음.
    데이터 손실 방지를 위해 고가용성을 위해 이중화 또는 다중화로 구성함. AWS에서는 이를 다중 AZ배포라고 하며 같은 지역이라도 데이터가 나뉘어져 있어서 Master에서 문제가 생기면 Slave에서 이를 복구해 데이터를 유지함. 이러한 가동률은 퍼센트로 나타내는데 파이브나인스(99.999%)처럼 표시하며 소주점 한자리를 늘릴때마다 서버 장비 사양이 달라짐.
4. 기타 하드웨어
    무정전 전원 공급장치 : 전원차단 방지
    KVM 스위치 : 여러대 서버 관리
    서버 랙 : 서버 장비 설치에 사용, 19인치 랙 많이 사용됨
5. 방화벽
    보안을 위해 내부 네트워크와 외부 네트워크 통신을 제어하고 불필요한 통신을 차단하는 것.
    - 패킷 필터형 : 통과하는 패킷을 포트 번호나 IP 주소를 바탕으로 필터링함.
    - 애플리케이션 게이트웨이형 : 애플리케이션 프로토콜 레벨에서 외부와의 통신을 제어하는 방식으로 일반적으로 프록시 서버라고 부름. 세션에 포함되어 있는 정보를 검사하기 위해서 기존 세션을 종료하고 새로운 세션을 만듬. 패킷 필터형에 비해서 속도는 느리나 많은 검사를 수행할 수 있음.
### 6. 네트워크
1. 네트워크 주소
    네트워크에서 각종 장비를 식벼랗기 위해 네트워크 주소를 사용함.
2. MAC 
    48bit, 앞 24bit는 네트워크 부품의 제조업체, 뒤 24bit는 각 제조업체가 중복되지 않도록 할당함. 16진수로 표기하며 2byte씩 구분해서 표기함.
3. IP
    인터넷, 인트라넷 같은 네트워크에 연결된 장비에 할당되는 번호. 
    IPv4 : 8bit 4개로 구분된 32bit 주소, 각 자리는 0~255까지 표현이 가능함. 하나의 네트워크에 2의 32승까지밖에 연결할 수가 없어서 인터넷에서 IP주소가 고갈될 우려가 있음
    IPv6 : 128비트의 IP주소를 사용하고 있음. 사내 네트워크에서는 임의의 주소를 할당하는 프라이빗 주소를 사용하고 인터넷과의 경계에서 글로벌 주소로 변환하는 NAT 장비를 사용함.
4. OSI
    통신할 때 메시지 주고 받는 언어를 사용할지 등 규칙이 필요한데 이런 규약을 통신 프로토콜이라고 함.
    OSI 모델은 국제 표준화 기구에서 만든 컴퓨터의 통신 기능을 계층 구조로 나눈 모델임.
    이를 이용해 특정 네트워킹 시스템에서 일어나는 일을 계층을 활용해 시각적으로 이해할 수 있음.
    - **물리 계층(Physical Layer)**
        케이블을 통해 전송하는 기능으로 전압과 전류의 값을 할당하거나 케이블이나 커넥터의 모양 등 통신 장비의 물리적 전기적 특성을 규정함. 
        LAN 케이블로 사용되는 트웨스트 페어 케이블(STP/UTP)이나 이더넷(Ethernet) 규격인 100BASE-T 또는 IEEE802.11 시리즈의 무선 통신 등이 있음.
    - **데이터 링크 계층(Data Link Layer)**
        동일 네트워크 간 인접한 두 시스템(노드) 간 통신을 규정함. 물리 계층이 데이터를 보내고 받고 하는 기능을 한다면 데이터 링크 계층은 물리 계층이 잘 동작하고 있는지 확인하는 역할.
        네트워크 계층에서 데이터 패킷을 받아들여 MAC 주소와 각종 제어 정보를 추가함. 이때 추가정보를 가지고 있는 데이터 단위를 frame이라 하고 물리 계층을 통해 전송됨.
        이 레이어에서 동작하는 L2 스위치라는 장비는 통신 하고 싶은 노드가 어떤 포트와 연결되어 있는지를 MAC 주소로 판단하고 패킷을 전송하는 장비.
    - **네트워크 계층(Network Layer)**
        서로 다른 네트워크 간 통신을 위한 규정. 특정 서버로 가는 경로를 효율적으로 처리하는 라우팅 기능이 있음. 데이터 링크 계층이 MAC 주소를 기반으로 한다면 네트워크 계층은 IP 주소를 기반으로 함.
        데이터 계층이 노드 간 전달을 담당하는 반면 네트워크 계층은 송신지에서 최종 수신지까지 데이터를 안전하게 전달하는 것을 담당함. 이를 위해 패킷의 이동량이 많을 때는 패킷의 흐름을 제어하는 흐름제어 기능과 전송 중 분실되는 패킷을 감지하고 재전송을 요구하는 오류 제어 기능을 가지고 있음.
        대표적인 장비로는 라우터나 L3 스위치가 있으며 이런 장비는 패킷을 어디에서 어디로 전송할지에 대한 정보를 저장하는 라우팅 테이블을 관리함. 이 테이블을 기반으로 루트를 정하는 정적 라우트와 라우팅 프로토콜에서 설정된 동적 라우트가 있음. L3 스위치는 라우터와 동일한 기능을 하드웨어로 처리하는 장비임.
    - **전송 계층(Transport Layer)**
        데이터 전송을 제어하는 계층으로 보낼 데이터의 용량, 속도, 목적지 등을 처리함. 세션 계층에서 보낸 메시지를 세그먼트로 나누고 각 세그먼트의 순서 번호를 기록해서 네트워크 계층으로 보내면 받는 쪽에서는 이를 다시 조립함. 이런 방식으로 전송 오류 검출이나 재전송을 규정함. 대표적인 프로토콜로 TCP, UDP가 있음.
    - **세션 계층(Session Layer)**
        애플리케이션 간 연결을 유지 및 해제하는 역할을 함. 커넥션 확립 타이밍이나 데이터 전송 타이밍 등을 규정함.
    - **프레젠테이션 계층(Presenation Layer)**
        데이터를 애플리케이션이 이해할 수 있도록 변환해주는 역할을 함. 데이터의 저장 형식, 압축, 문자 인코딩 등을 변환하고 데이터를 안전하게 전송하기 위해 암호화, 복호화하는 기능도 이 계층에서 처리함.
    - **응용 계층(Application Layer)**
        최상위 계층으로 웹 브라우저나 아웃룩처럼 사용자가 직접 사용하는 애플리케이션.
### 7. 리눅스
- Linus Torvalds가 개발한 Unix 호환 서버 OS. 리눅스 재단에 따르면 퍼블리 클라우드 워크로드 90%, 스마트폰 82%, 임베디드 기기 62%, 슈퍼컴퓨터 시장 99%가 리눅스로 동작함. 리눅스는 서버, 모바일 운영체제로는 많이 쓰이나 데스크탑에서는 많이 쓰이지 않음.
1. 리눅스 커널
    커널이란 OS의 코어로 메모리 관리, 파일 시스템, 프로세스 관리, 디바이스 제어의 역할을 함. 안드로이드 또한 리눅스 커널을 기반으로 만들어짐.
    - **디바이스 관리**
        리눅스 커널은 CPU, 메모리, 디스크, IO 등 하드웨어를 디바이스 드라이버라는 소프트웨어를 이용해 제어함.
    - **프로세스 관리**
        리눅스는 프로그램 파일에 쓰여 있는 내용을 읽어서 메모리 상에서 처리하는데 이렇게 실행됨 프로그램을 프로세스라고 함. 이 프로세스를 식별하기 위해 PID(Process ID)를 붙여서 관리하고 각 프로세스에 필요한자원을 효율적으로 할당함.
    - **메모리 관리**
        프로세스에 필요한 메모리를 할당하고 제어함. 다만 메모리가 부족한 경우에는 하드디스크와 같은 보조 기억장치에 가상 메모리 영역을 만들어 사용하는데 이를 스왑(swap)이라고 함.
    - **쉘**
        쉘이라는 커맨드라인 인터페이스를 통해 명령어를 커널로 전달할 수 있음. 쉘에서 실행하고자 하는 명령을 모아놓은 것을 쉘 스크립트라고 함.
        - bash  
        - csh
        - tsch
        - zsh
    - **파일 시스템**
        파일 시스템이란 파일에 이름을 붙여서 어디에 저장할지 나타내는 체계임. 파일을 관리하는 시스템.
        리눅스 커널은 가상 파일 시스템(VFS)을 사용함. 사용자 입장에서 각 데이터가 저장되어 있는 위치와 상관없이 그냥 파일처럼 사용할 수 있도록 하는 것임. VFS에서는 각 디바이스를 파일로 취급함.
        - ext2
        - ext3
        - ext4
        - tmpfs
        - UnionFS
        - NFS
2. 디렉토리 구성
    리눅스의 디렉토리 목록은 FHS(Filesystem Hierarchy Standard)라는 규격으로 표준화되어 있음. 대부분의 주요 배포판은 이 FHS를 기반으로 디렉토리를 구성함.
    - /
    - /bin
    - /boot
    - /dev
    - /etc
    - /home
    - /proc
    - /sbin
    - /tmp
    - /usr
    - /var
3. 보안 기능
    - **계정에 대한 권한 설정**
        리눅스는 사용자 계정에 권한을 설정할 수 있음. 시스템 전체를 관리하는 root 사용자와 그 외 일반 사용자가 있음. 미들웨어와 같은 데몬을 작동시키기 위한 시스템 계정도 있음.
        계정은 그룹으로 묶을 수도 있음. 이런 계정과 그룹을 바탕으로 파일이나 디렉토리에 대한 액세스 권한(permission)을 설정할 수 있음.
    - **네트워크 필터링**
        리눅스는 원래 네트워크 상에서 여러 사용자가 이용하는 것을 전제로 만든 OS 이므로 네트워크 관련이 기능이 많음. iptables는 리눅스에 내장된 패킷 필터링 및 NAT를 설정할 수 있는 기능.
    - **SELinux**
        SELinux는 미국 국가안전보장국이 제공하는 리눅스 커널에 강제 액세스 제어 기능을 추가한 기능.
        리눅스는 root 사용자가 퍼미션에 상관없이 모든 액세스가 가능해서 root 계정이 도난당하면 시스템에 치명적인 영향을 줌.
        SELinux는 프로세스마다 액세스 제한을 거는 TE(Type Enforcement)와 root를 포함한 모든 사용자에게 제어를 거는 RBAC(Role-based Access Control)등으로 root에게 권한이 집중되는 것을 막아줌.
4. 리눅스 배포판
    보통 리눅스는 커널 위에 각종 커맨드, 라이브러리, 애플리케이션 등을 포함해 배포판이라는 패키지 형태로 배포됨. 오픈소스라서 개인 또는 기업이 직접 수정해서 사용할 수 있음.
    - Debian 계열
        - Debian
        - KNOPPIX
        - Ubuntu
    - Red Hat 계열
        - Fedora
        - Red Hat Enterprise Linux
        - CentOS
        - Vine Linux
    - Slackware 계열
        - openSUSE
        - SUSE Linux Enterprise
    - 기타 배포판
        - Arch Linux
        - Gentoo Linux
### 8. 미들웨어
OS와 비즈니스를 처리하는 애플리케이션 사이에 들어가는 각종 소프트웨어로 웹 서버, DBMS, 시스템 모니터링 툴 등이 있음. 
1. 웹 서버
    클라이언트가 보낸 HTTP 요청을 받아 웹 콘텐츠를 응답으로 반환하거나 서버쪽 애플리케이션을 호출하는 기능을 가진 서버
    - Apache HTTP Server
    - Internet Information Services
    - Nginx
2. DBMS
    - RDBS
        - Oracle Database
        - MySQL
        - Microsoft SQL Server
        - PostgreSQL
    - NoSQL
        - Key-value
        - Document
        - Wide column stores
        - Graph
3. 시스템 모니터링
    시스템 운영을 위해서는 여러 상태를 지속적으로 감시해야 함. 네트워크, 서버, 클라우드, 애플리케이션, 서비스, 트랜잭션 등 다양한 레벨에서 모니터링을 하면서 이상 여부를 확인하고 원인을 분석함.
    - Zabbix
    - Datadog
    - Mackerel
### 9. 인프라 구성 관리
인프라 구성 관리란 인프라를 구성하는 하드웨어, 네트워크, OS, 미들웨어, 애플리케이션 등의 구성 정보를 관리하고 적절한 상태로 유지하는 작업을 의미함.
1. Immutable Infrastructure
    온프레미스 환경에서는 인프라 환경을 구축하는 것도 큰 일이고, 일단 구축하면 변경 이력을 정리하면서 상당히 오랜 기간 사용함.
    클라우드는 가상환경이기 때문에 필요하면 구축하고 불필요하면 바로 폐기해도 상관 없음. 즉 서비스가 업데이트되면 기존 운영 환경을 변경하는 대신 이미지를 새로 생성해 배포함.
    Immutable 인프라는 이미지 하나로 서버를 쉽게 찍어낼 수 있고 해당 이미지만 관리하면 되기 떄문에 관리도 용이함. 또한 환경 자체를 배포하기 떄문에 동일한 환경에서 테스트가 쉬움.
2. Infrastructure as Code
3. 인프라 구성 관리 툴
    - Bootstrapping 
    - Configuration 
    - Orchestration 
4. Continuous Integration 와 인프라
5. Continuous Delivery 와 인프라
### 10. 가상화
1. 호스트형 서버 가상화
2. 하이퍼바이저형 가상화
### 11. 컨테이너
1. 도커
2. 쿠버네티스